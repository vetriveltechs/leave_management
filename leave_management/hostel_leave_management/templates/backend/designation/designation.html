{% extends "backend/base/base.html" %}

{% block title %}Home | My Website{% endblock %}

{% block content %}
    {% load static %}

            <div class="content"><!-- Content start-->
                <div class="card"><!-- Card start-->
                    <div class="card-body">
                        {% if action == 'add' or action == 'edit' or action == 'view' %}
                            <form action="" --class="form-validate-jquery" enctype="multipart/form-data" method="POST">
								                {% csrf_token %}
                                <div class="header-lines">
                                <!-- Buttons start here -->
                                    <div class="row mb-3">
                                        <div class="col-md-6">
											<h3>
												<b>
													{% if action == 'add' %}
														Create
													{% elif action == 'edit' %}
														Edit
													{% elif action == 'view' %}
														View
													{% endif %}
													Designation
												</b>
											</h3>
                                        </div>
                                        <div class="col-md-6 text-right">
                                            {% if action == 'add' or action == 'edit' %}
                                                <button type="submit" name="save_btn" id="save_btn" onclick="return saveBtn('save_btn');" title="Save" class="btn btn-primary btn-sm form_submit_valid">Save</button>
                                                <button type="submit" name="submit_btn" id="submit_btn" onclick="return saveBtn('submit_btn');" title="Submit" class="btn btn-primary btn-sm form_submit_valid">Submit</button>
                                            {% endif %}

                                            <a href="{% url 'list_designation' %}" class="btn btn-default btn-sm">Close</a>
                                        </div>
                                    </div>
                                <!-- Buttons end here -->

                                    <fieldset>
                                        <section class="header-section">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="row">
                                                        <div class="col-md-4">
                                                        <div class="form-group text-right">
                                                            <label class="col-form-label designation_name"><span class="text-danger">*</span> Designation Name</label>
                                                        </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                        <div class="form-group">
                                                            <input type="text" id="designation_name" name="designation_name" autocomplete="off" class="form-control" value="{% if data %}{{ data.designation_name }}{% endif %}" placeholder="Designation Name">
                                                        </div>
                                                        </div>
                                                    </div>
                                                <div class="row">
                                                    <div class="col-md-4">
                                                    <div class="form-group text-right">
                                                        <label class="col-form-label description">Description</label>
                                                    </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                    <div class="form-group">
                                                        <textarea name="description" id="description" rows="1" autocomplete="off" class="form-control" placeholder="Description">{% if data %}{{ data.description }}{% endif %}</textarea>
                                                    </div>
                                                    </div>
                                                </div>
                                                </div>
                                                <div class="col-md-6">
                                                </div>

                                            </div>
                                        </section>

                                        <script>
                                            function saveBtn(val)
                                            {
                                                // $(".form_submit_valid").prop('disabled', true);

                                                var designation_name   	= $("#designation_name").val();


                                                if (designation_name.trim() !== "")
                                                {
                                                    $(".designation_name").removeClass('errorClass');

                                                    return true;
                                                }
                                                else
                                                {
                                                    // $(".form_submit_valid").prop('disabled', false);

                                                    if (designation_name.trim() === "")
                                                    {
                                                        $(".designation_name").addClass('errorClass');
                                                    }

                                                    return false;
                                                }
                                            }
                                        </script>

                                    </fieldset>
                                    <div class="col-md-12 mt-3 pr-0 text-right">
                                        {% if action == 'add' or action == 'edit' %}
                                            <button type="submit" name="save_btn" id="save_btn" onclick="return saveBtn('save_btn');" title="Save" class="btn btn-primary btn-sm form_submit_valid">Save</button>
                                            <button type="submit" name="submit_btn" id="submit_btn" onclick="return saveBtn('submit_btn');" title="Submit" class="btn btn-primary btn-sm form_submit_valid">Submit</button>
                                        {% endif %}

                                        <a href="{% url 'list_designation' %}" class="btn btn-default btn-sm">Close</a>
                                	</div>
								</div>
                            </form>
                        {% else %}
                            <div class="row">
                                <div class="col-md-6"><h3><b>{{ page_title }}</b></h3></div>
                                <div class="col-md-6 float-right text-right">


                                  <a href="{% url 'add_designation' 'add' %}" class="btn btn-info btn-sm">
                                      Create Designation
                                  </a>

                                </div>
                            </div>
                            <form action="" class="form-validate-jquery" method="get">
                                <div class="row mt-3">
                                    <div class="col-md-4">
                                        <div class="row">
                                        <label class="col-form-label col-md-5 text-right">Designation Name</label>
                                        <div class="form-group col-md-7">
                                        <input type="search" class="form-control" name="designation_name" value="{{ request.GET.designation_name|default:'' }}" placeholder="Designation Name" autocomplete="off">
                                        </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="row">
                                            <label class="col-form-label col-md-5 text-right">Status</label>
                                            <div class="form-group col-md-7">
                                                <select name="active_flag" id="active_flag" class="form-control searchDropdown">
                                                    {# Optional default option #}
                                                    <!-- <option value="">- Select -</option> -->
                                                    {% for row in activeFlag %}
                                                    {% with selected=request.GET.active_flag %}
                                                        <option value="{{ row.list_code }}" {% if selected == row.list_code %}selected{% endif %}>
                                                        {{ row.list_value|capfirst }}
                                                        </option>
                                                    {% endwith %}
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-2">
                                        <button type="submit" class="btn btn-info">Search <i class="fa fa-search"></i></button>
                                        <a href="{% url 'list_designation' %}" title="Clear" class="btn btn-default">Clear</a>
                                    </div>
                                </div>

                                {% if request.GET %}
                                    <div class="row mt-3">
                                        {% if designations|length > 0 %}
                                            <div class="col-md-11">
                                              <a href="{% url 'list_designation' %}?designation_name={{ designation_name }}&active_flag={{ active_flag }}&export=1" class="btn btn-primary btn-sm">
                                                Export CSV
                                            </a>

                                            </div>
                                            <div class="col-md-1 float-right text-right mb-3">
                                                <select name="limit" class="form-control mr-2" onchange="this.form.submit()">
                                                    {% for option in limit_options %}
                                                        <option value="{{ option }}" {% if option == limit %}selected{% endif %}>{{ option }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="new-scroller">
                                        <table id="myTable" class="table table-bordered table-hover tbl_height">
                                            <thead>
                                                <tr>
                                                <th class="text-center tab-md-100">Controls</th>
                                                <th class="text-left tab-md-140">Designation Name</th>
                                                <th class="text-left tab-md-140">Description</th>
                                                <th class="text-center tab-md-100">Status</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for row in designations %}
                                                <tr>
                                                    <td class="text-center">
                                                        <div class="dropdown">
                                                            <button type="button" class="btn btn-outline-info gropdown-toggle btn-sm" data-toggle="dropdown" aria-expanded="false">
                                                            Action&nbsp;<i class="fa fa-chevron-down"></i>
                                                            </button>
                                                            <ul class="table-dropdown dropdown-menu dropdown-menu-right">
                                                                <li>
                                                                    <a title="Edit" href="{% url 'edit_view_designation' 'edit' row.id %}">
                                                                    <i class="fa fa-edit"></i> Edit
                                                                    </a>
                                                                </li>
                                                                <li>
                                                                    <a title="View" href="{% url 'edit_view_designation' 'view' row.id %}">
                                                                    <i class="fa fa-eye"></i> View
                                                                    </a>
                                                                </li>
                                                                <li>
                                                                    {% if row.active_flag == 'Y' %}
                                                                    <a class="unblock" href="{% url 'edit_view_designation' 'status' row.id %}?status=N" title="Inactive">
                                                                        <i class="fa fa-ban"></i> Inactive
                                                                    </a>
                                                                    {% else %}
                                                                    <a class="block" href="{% url 'edit_view_designation' 'status' row.id %}?status=Y" title="Active">
                                                                        <i class="fa fa-check"></i> Active
                                                                    </a>
                                                                    {% endif %}


                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </td>
                                                    <td>{{ row.designation_name|capfirst }}</td>
                                                    <td>{{ row.description|capfirst }}</td>
                                                    <td class="text-center">
                                                    {% if row.active_flag == 'Y' %}
                                                        <span class="btn btn-outline-success btn-sm" title="Active">Active</span>
                                                    {% else %}
                                                        <span class="btn btn-outline-warning btn-sm" title="Inactive">Inactive</span>
                                                    {% endif %}
                                                    </td>
                                                </tr>
                                                {% empty %}
                                                <tr>
                                                    <td colspan="4" class="text-center">
                                                    <img src="{% static 'uploads/nodata.png' %}" alt="No data">
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                    {% if designations|length > 0 %}
                                        <div class="mb-2">
                                            Showing {{ starting }} to {{ ending }} of {{ totalRows }} entries
                                        </div>
                                    {% endif %}

                                    <!-- Pagination -->
                                    <div class="col-md-12 text-right" style="float:right;padding: 0px 20px 0px 0px;">
                                        <ul class="pagination">
                                            <!-- Previous -->
                                            <li class="page-item {% if current_page <= 1 %}disabled{% endif %}">
                                                {% if current_page > 1 %}
                                                    <a class="page-link" href="?page={{ current_page|add:"-1" }}&limit={{ limit }}&designation_name={{ designation_name }}&active_flag={{ active_flag }}">Prev</a>
                                                {% else %}
                                                    <span class="page-link">Prev</span>
                                                {% endif %}
                                            </li>

                                            <!-- Page Numbers -->
                                            {% for page_num in pagination %}
                                                <li class="page-item {% if page_num == current_page %}active{% endif %}">
                                                    {% if page_num == current_page %}
                                                        <span class="page-link">{{ page_num }}</span>
                                                    {% else %}
                                                        <a class="page-link" href="?page={{ page_num }}&limit={{ limit }}&designation_name={{ designation_name }}&active_flag={{ active_flag }}">{{ page_num }}</a>
                                                    {% endif %}
                                                </li>
                                            {% endfor %}

                                            <!-- Next -->
                                            <li class="page-item {% if current_page >= pagination|last %}disabled{% endif %}">
                                                {% if current_page < pagination|last %}
                                                    <a class="page-link" href="?page={{ current_page|add:"1" }}&limit={{ limit }}&designation_name={{ designation_name }}&active_flag={{ active_flag }}">Next</a>
                                                {% else %}
                                                    <span class="page-link">Next</span>
                                                {% endif %}
                                            </li>
                                        </ul>


                                    </div>
                                {% endif %}
                              </form>
                        {% endif %}

                    </div>
                </div>
            </div>

{% endblock %}
